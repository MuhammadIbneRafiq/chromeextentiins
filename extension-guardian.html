<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extension Guardian</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: #ffffff;
        }
        .container {
            background: #2d2d2d;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        }
        h1 {
            color: #ff6b6b;
            text-align: center;
            margin-bottom: 30px;
        }
        .status {
            background: #3d3d3d;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }
        .status.active {
            background: #2d5a2d;
            border: 2px solid #4ade80;
        }
        .status.inactive {
            background: #5a2d2d;
            border: 2px solid #f87171;
        }
        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
        }
        button {
            background: #4f46e5;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }
        button:hover {
            background: #3730a3;
        }
        button.danger {
            background: #dc2626;
        }
        button.danger:hover {
            background: #b91c1c;
        }
        button.success {
            background: #059669;
        }
        button.success:hover {
            background: #047857;
        }
        .instructions {
            background: #1e293b;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .instructions h3 {
            color: #60a5fa;
            margin-top: 0;
        }
        .instructions ol {
            padding-left: 20px;
        }
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.5;
        }
        .bookmarklet {
            background: #374151;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 12px;
            word-break: break-all;
            border: 1px solid #4b5563;
        }
        .copy-btn {
            background: #6b7280;
            font-size: 12px;
            padding: 8px 12px;
            margin-top: 10px;
        }
        .copy-btn:hover {
            background: #4b5563;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üõ°Ô∏è Extension Guardian</h1>
        
        <div class="status" id="status">
            <h3>Status: <span id="statusText">Checking...</span></h3>
            <p id="statusMessage">Initializing extension monitoring...</p>
        </div>
        
        <div class="controls">
            <button id="startBtn" class="success">Start Monitoring</button>
            <button id="stopBtn" class="danger">Stop Monitoring</button>
            <button id="checkBtn">Check Now</button>
            <button id="reEnableBtn">Force Re-enable</button>
        </div>
        
        <div class="instructions">
            <h3>üìã How to Use</h3>
            <ol>
                <li><strong>Start Monitoring:</strong> Click "Start Monitoring" to begin protecting your extension</li>
                <li><strong>Auto-Recovery:</strong> The guardian will automatically detect when your extension is disabled</li>
                <li><strong>Re-enable:</strong> It will attempt to re-enable the extension automatically</li>
                <li><strong>Manual Recovery:</strong> If auto-recovery fails, it will open the extensions page</li>
            </ol>
            
            <h3>üîñ Bookmarklet Method</h3>
            <p>For persistent protection, save this as a bookmark and run it on any page:</p>
            <div class="bookmarklet" id="bookmarkletCode">
                javascript:(function(){'use strict';const EXTENSION_ID='ihgblohlcibknaohodhpmonfbegkoafd';const CHECK_INTERVAL=5000;let isMonitoring=false;let checkInterval=null;console.log('üõ°Ô∏è Extension Guardian started');async function checkExtensionStatus(){try{if(chrome&&chrome.management){const extension=await chrome.management.get(EXTENSION_ID);return extension.enabled;}try{if(chrome&&chrome.runtime&&chrome.runtime.id===EXTENSION_ID){return true;}}catch(e){return false;}return false;}catch(error){console.log('‚ùå Error checking extension status:',error);return false;}}async function attemptReEnable(){try{console.log('üîÑ Attempting to re-enable extension...');if(chrome&&chrome.management){await chrome.management.setEnabled(EXTENSION_ID,true);console.log('‚úÖ Extension re-enabled successfully');return true;}window.open('chrome://extensions/','_blank');console.log('üìÑ Opened extensions page for manual re-enabling');return false;}catch(error){console.log('‚ùå Failed to re-enable extension:',error);return false;}}function showNotification(message,type='info'){const notification=document.createElement('div');notification.style.cssText=`position:fixed;top:20px;right:20px;padding:15px 20px;background:${type==='error'?'#dc2626':type==='success'?'#10b981':'#667eea'};color:white;border-radius:8px;font-size:14px;font-weight:bold;z-index:10000;box-shadow:0 4px 12px rgba(0,0,0,0.3);max-width:300px;`;notification.innerHTML=`<div style="display:flex;align-items:center;gap:10px;"><span>${type==='error'?'üö®':type==='success'?'‚úÖ':'‚ÑπÔ∏è'}</span><span>${message}</span></div>`;document.body.appendChild(notification);setTimeout(()=>{if(notification.parentNode){notification.parentNode.removeChild(notification);}},5000);}async function monitorExtension(){const isEnabled=await checkExtensionStatus();if(!isEnabled&&isMonitoring){console.log('üö® Extension is disabled! Attempting recovery...');showNotification('Extension was disabled! Attempting to re-enable...','error');const reEnabled=await attemptReEnable();if(reEnabled){showNotification('Extension re-enabled successfully!','success');}else{showNotification('Please manually re-enable the extension','error');}}}function startMonitoring(){if(isMonitoring){console.log('‚ö†Ô∏è Monitoring already active');return;}isMonitoring=true;console.log('üõ°Ô∏è Starting extension monitoring...');showNotification('Extension Guardian is now protecting your extension','success');monitorExtension();checkInterval=setInterval(monitorExtension,CHECK_INTERVAL);}function stopMonitoring(){if(!isMonitoring){console.log('‚ö†Ô∏è Monitoring not active');return;}isMonitoring=false;console.log('üõ°Ô∏è Stopping extension monitoring...');if(checkInterval){clearInterval(checkInterval);checkInterval=null;}showNotification('Extension Guardian stopped','info');}window.ExtensionGuardian={start:startMonitoring,stop:stopMonitoring,check:monitorExtension,reEnable:attemptReEnable,isMonitoring:()=>isMonitoring};startMonitoring();console.log('üõ°Ô∏è Extension Guardian loaded. Use ExtensionGuardian.start() or ExtensionGuardian.stop() to control.');})();
            </div>
            <button class="copy-btn" onclick="copyBookmarklet()">Copy Bookmarklet</button>
        </div>
    </div>

    <script>
        // Extension Guardian Script
        (function() {
            'use strict';
            
            const EXTENSION_ID = 'ihgblohlcibknaohodhpmonfbegkoafd';
            const CHECK_INTERVAL = 5000;
            let isMonitoring = false;
            let checkInterval = null;
            
            // UI Elements
            const statusDiv = document.getElementById('status');
            const statusText = document.getElementById('statusText');
            const statusMessage = document.getElementById('statusMessage');
            const startBtn = document.getElementById('startBtn');
            const stopBtn = document.getElementById('stopBtn');
            const checkBtn = document.getElementById('checkBtn');
            const reEnableBtn = document.getElementById('reEnableBtn');
            
            // Update UI
            function updateStatus(isActive, message) {
                statusText.textContent = isActive ? 'Active' : 'Inactive';
                statusMessage.textContent = message;
                statusDiv.className = `status ${isActive ? 'active' : 'inactive'}`;
            }
            
            // Check extension status
            async function checkExtensionStatus() {
                try {
                    if (chrome && chrome.management) {
                        const extension = await chrome.management.get(EXTENSION_ID);
                        return extension.enabled;
                    }
                    
                    try {
                        if (chrome && chrome.runtime && chrome.runtime.id === EXTENSION_ID) {
                            return true;
                        }
                    } catch (e) {
                        return false;
                    }
                    
                    return false;
                } catch (error) {
                    console.log('‚ùå Error checking extension status:', error);
                    return false;
                }
            }
            
            // Attempt to re-enable extension
            async function attemptReEnable() {
                try {
                    console.log('üîÑ Attempting to re-enable extension...');
                    
                    if (chrome && chrome.management) {
                        await chrome.management.setEnabled(EXTENSION_ID, true);
                        console.log('‚úÖ Extension re-enabled successfully');
                        return true;
                    }
                    
                    window.open('chrome://extensions/', '_blank');
                    console.log('üìÑ Opened extensions page for manual re-enabling');
                    
                    return false;
                } catch (error) {
                    console.log('‚ùå Failed to re-enable extension:', error);
                    return false;
                }
            }
            
            // Show notification
            function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    padding: 15px 20px;
                    background: ${type === 'error' ? '#dc2626' : type === 'success' ? '#10b981' : '#667eea'};
                    color: white;
                    border-radius: 8px;
                    font-size: 14px;
                    font-weight: bold;
                    z-index: 10000;
                    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                    max-width: 300px;
                `;
                
                notification.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span>${type === 'error' ? 'üö®' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è'}</span>
                        <span>${message}</span>
                    </div>
                `;
                
                document.body.appendChild(notification);
                
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 5000);
            }
            
            // Main monitoring function
            async function monitorExtension() {
                const isEnabled = await checkExtensionStatus();
                
                if (!isEnabled && isMonitoring) {
                    console.log('üö® Extension is disabled! Attempting recovery...');
                    updateStatus(false, 'Extension disabled! Attempting recovery...');
                    showNotification('Extension was disabled! Attempting to re-enable...', 'error');
                    
                    const reEnabled = await attemptReEnable();
                    
                    if (reEnabled) {
                        updateStatus(true, 'Extension re-enabled successfully!');
                        showNotification('Extension re-enabled successfully!', 'success');
                    } else {
                        updateStatus(false, 'Please manually re-enable the extension');
                        showNotification('Please manually re-enable the extension', 'error');
                    }
                } else if (isEnabled && isMonitoring) {
                    updateStatus(true, 'Extension is enabled and protected');
                }
            }
            
            // Start monitoring
            function startMonitoring() {
                if (isMonitoring) {
                    console.log('‚ö†Ô∏è Monitoring already active');
                    return;
                }
                
                isMonitoring = true;
                console.log('üõ°Ô∏è Starting extension monitoring...');
                updateStatus(true, 'Extension Guardian is now protecting your extension');
                showNotification('Extension Guardian is now protecting your extension', 'success');
                
                // Initial check
                monitorExtension();
                
                // Set up interval
                checkInterval = setInterval(monitorExtension, CHECK_INTERVAL);
            }
            
            // Stop monitoring
            function stopMonitoring() {
                if (!isMonitoring) {
                    console.log('‚ö†Ô∏è Monitoring not active');
                    return;
                }
                
                isMonitoring = false;
                console.log('üõ°Ô∏è Stopping extension monitoring...');
                updateStatus(false, 'Extension Guardian stopped');
                
                if (checkInterval) {
                    clearInterval(checkInterval);
                    checkInterval = null;
                }
                
                showNotification('Extension Guardian stopped', 'info');
            }
            
            // Event listeners
            startBtn.addEventListener('click', startMonitoring);
            stopBtn.addEventListener('click', stopMonitoring);
            checkBtn.addEventListener('click', monitorExtension);
            reEnableBtn.addEventListener('click', attemptReEnable);
            
            // Copy bookmarklet function
            window.copyBookmarklet = function() {
                const bookmarkletCode = document.getElementById('bookmarkletCode').textContent;
                navigator.clipboard.writeText(bookmarkletCode).then(() => {
                    showNotification('Bookmarklet copied to clipboard!', 'success');
                }).catch(() => {
                    showNotification('Failed to copy bookmarklet', 'error');
                });
            };
            
            // Expose functions globally
            window.ExtensionGuardian = {
                start: startMonitoring,
                stop: stopMonitoring,
                check: monitorExtension,
                reEnable: attemptReEnable,
                isMonitoring: () => isMonitoring
            };
            
            // Initial status check
            updateStatus(false, 'Extension Guardian ready. Click "Start Monitoring" to begin.');
            
            console.log('üõ°Ô∏è Extension Guardian loaded. Use ExtensionGuardian.start() or ExtensionGuardian.stop() to control.');
            
        })();
    </script>
</body>
</html>

